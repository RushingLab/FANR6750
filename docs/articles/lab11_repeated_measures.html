<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lab 11: Repeated measures • FANR6750</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lab 11: Repeated measures">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FANR6750</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2025.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../articles/syllabus.html"><span class="fa fas fa-book"></span> Syllabus</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/schedule.html"><span class="fa fas fa-calendar"></span> Schedule</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lectures" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-file-pdf-o"></span> Lectures</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lectures">
<li><a class="dropdown-item" href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/01_intro_to_stats/01_intro_to_stats.html">Lecture 1: Introduction to statistics</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/02_intro_to_lm/02_intro_to_lm.html">Lecture 2: Introduction to linear models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/03_inference/03_inference.html">Lecture 3: Principles of inference</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/04_principles_of_expdesign/04_expdesign.html">Lecture 4: Principles of experimental design</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/05_t-test/05_t-test.html">Lecture 5: Linear models part 1: categorical predictor w/ 2 levels</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/06_nht/06_nht.html">Lecture 6: Null hypothesis significance testings</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/07_power/07_power.html">Lecture 7: Statistical power</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/08_anova/08_anova.html">Lecture 8: Linear models part 2: categorical predictor &gt; 2 levels</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/09_mult_comp/09_mult_comp.html">Lecture 9: Multiple Comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/10_regression/10_regression.html">Lecture 10: Multiple Regression</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-labs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-desktop"></span> Labs</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-labs">
<li><a class="dropdown-item" href="../articles/lab01_intro_to_R.html">Lab 1: Introduction to R</a></li>
    <li><a class="dropdown-item" href="../articles/lab02_Intro_project_and_Rmd.html">Lab 2: Introduction to projects and RMarkdown</a></li>
    <li><a class="dropdown-item" href="../articles/lab03_inference.html">Lab 3: Using R to explore sampling error</a></li>
    <li><a class="dropdown-item" href="../articles/lab04_t-tests.html">Lab 4: t-tests</a></li>
    <li><a class="dropdown-item" href="../articles/lab05_anova.html">Lab 5: ANOVA</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-references" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-pencil-square-o"></span> References</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-references">
<li><a class="dropdown-item" href="../articles/homework.html">Assignment instructions</a></li>
    <li><a class="dropdown-item" href="../articles/projects_and_directories.html">Projects and directories</a></li>
    <li><a class="dropdown-item" href="../articles/RMarkdown.html">R Markdown reference</a></li>
    <li><a class="dropdown-item" href="../articles/graphics.html">Creating publication-quality graphics</a></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Lab 11: Repeated measures</h1>
            <h3 data-toc-skip class="subtitle">FANR 6750: Experimental
Methods in Forestry and Natural Resources Research</h3>
                        <h4 data-toc-skip class="author">Fall 2024</h4>
            
      

      <div class="d-none name"><code>lab11_repeated_measures.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="lab-10">Lab 10<a class="anchor" aria-label="anchor" href="#lab-10"></a>
</h3>
<ul>
<li>
<p>Split Plot</p>
<ul>
<li><p>The additive model</p></li>
<li><p>Using aov() and lme()</p></li>
<li><p>Exploring interactions</p></li>
<li><p>Multiple comparisons</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="todays-topics">Today’s topics<a class="anchor" aria-label="anchor" href="#todays-topics"></a>
</h3>
<ul>
<li>
<p>Repeated Measures</p>
<ul>
<li><p>The additive model</p></li>
<li>
<p>Univariate approach</p>
<ul>
<li><p>Adjusted p-values</p></li>
<li><p>MANOVA</p></li>
</ul>
</li>
<li>
<p>Multivariate approach</p>
<ul>
<li>Profile analysis</li>
</ul>
</li>
<li><p>Linear mixed effects</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Experiments that use “repeated measures” are those that have the
following components:</p>
<ol style="list-style-type: decimal">
<li><p>We randomly assign each ‘subject’ to a treatment</p></li>
<li><p>We record the response to the treatment over time</p></li>
</ol>
<p><br></p>
<p>In these cases, we need to think about several sources of variation
in the model:</p>
<ol style="list-style-type: decimal">
<li><p>Treatment</p></li>
<li><p>Time</p></li>
<li><p>Treatment-time interaction</p></li>
<li><p>Random variation among subjects</p></li>
<li><p>Random variation within subjects</p></li>
</ol>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="approaches">Approaches<a class="anchor" aria-label="anchor" href="#approaches"></a>
</h2>
<p>As we saw in lecture, there are several ways to analyze repeated
measures data.</p>
<div class="section level3">
<h3 id="univariate-approach">Univariate approach<a class="anchor" aria-label="anchor" href="#univariate-approach"></a>
</h3>
<ul>
<li><p>One way is to view a repeated measures design as similar to a
split-plot design (or nested and crossed)</p></li>
<li><p>Because we know that the residuals are correlated, we will need
to adjust the <em>p</em>-values (Greenhouse-Geisser or Huynh-Feldt
methods)</p></li>
<li><p>In <code>R</code>, somewhat counter-intuitively, you must conduct
a multivariate analysis of variance (MANOVA) to obtain these adjusted
<em>p</em>-values</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="multivariate-approach-intervals">Multivariate approach (intervals)<a class="anchor" aria-label="anchor" href="#multivariate-approach-intervals"></a>
</h3>
<ul>
<li><p>Another way to look at repeated measures data is to perform a
MANOVA on the differences</p></li>
<li><p>This will allow us to determine during which time intervals the
treatment was having an effect (profile analysis)</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="mixed-effects-model-with-ar-correlation-structure">Mixed effects model with (AR) correlation structure<a class="anchor" aria-label="anchor" href="#mixed-effects-model-with-ar-correlation-structure"></a>
</h3>
<ul>
<li><p>This can be done using <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code></p></li>
<li><p>Involves accounting for serial autocorrelation directly in the
model</p></li>
<li><p>Preferred for unbalanced designs and complex models</p></li>
<li><p>Multiple courses on campus that explore these topics</p></li>
</ul>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="univariate-approach-1">Univariate Approach<a class="anchor" aria-label="anchor" href="#univariate-approach-1"></a>
</h2>
<p>The dataset below contains information on leaf growth by 10 plants
subjected to different fertilizer treatments. Leaf growth on each plant
was measured weekly for 5 weeks.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rushinglab.github.io/FANR6750">FANR6750</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"plantdata"</span><span class="op">)</span></span></code></pre></div>
<p>Before begining the analysis, we will want to convert some variables
to factors.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plantdata</span><span class="op">$</span><span class="va">plant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plantdata</span><span class="op">$</span><span class="va">plant</span><span class="op">)</span></span>
<span><span class="va">plantdata</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plantdata</span><span class="op">$</span><span class="va">fertilizer</span><span class="op">)</span></span>
<span><span class="va">plantdata</span><span class="op">$</span><span class="va">week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plantdata</span><span class="op">$</span><span class="va">week</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">plantdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    50 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ plant     : Factor w/ 10 levels "1","2","3","4",..: 1 1 1 1 1 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ fertilizer: Factor w/ 2 levels "H","L": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ week      : Factor w/ 5 levels "1","2","3","4",..: 1 2 3 4 5 1 2 3 4 5 ...</span></span>
<span><span class="co">#&gt;  $ leaves    : int  4 5 6 8 10 3 4 6 6 9 ...</span></span></code></pre></div>
<p>As always, it helps to visualize the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plantdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">leaves</span>, </span>
<span>                      group <span class="op">=</span> <span class="va">plant</span>, </span>
<span>                      color <span class="op">=</span> <span class="va">fertilizer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span><span class="st">"Week"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Number of leaves"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="lab11_repeated_measures_files/figure-html/unnamed-chunk-4-1.png" alt="**Figure 1: Leaf growth on 10 plants subjected to two fertilizer treatments across five weeks**" width="576"><p class="caption">
<strong>Figure 1: Leaf growth on 10 plants subjected to two fertilizer
treatments across five weeks</strong>
</p>
</div>
<p><br></p>
<div class="section level3">
<h3 id="additive-model">Additive model<a class="anchor" aria-label="anchor" href="#additive-model"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><mi>μ</mi><mo>+</mo><msub><mi>α</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>α</mi><msub><mi>β</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>δ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
y_{ijk} = \mu + \alpha_i + \beta_j + \alpha\beta_{ij} + \delta_{ik} + \epsilon_{ijk}
</annotation></semantics></math></p>
<p>Where:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>:
Grand mean<br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_i</annotation></semantics></math>:
effect of the ith treatment level<br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\beta_j</annotation></semantics></math>:
effect of the jth time level<br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><msub><mi>β</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha\beta_{ij}</annotation></semantics></math>:
interaction effect between treatment and time levels<br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>δ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\delta_{ik}</annotation></semantics></math>:
effect of kth subject receiving the ith treatment level<br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>j</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\epsilon_{ijk}</annotation></semantics></math>:
residual error</p>
<p><br></p>
<p><strong>What would be the hypotheses related to this
model?</strong></p>
<p><strong>Which effects are fixed and which are random?</strong></p>
<p><br><br></p>
<p>Now let’s fit the univariate model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">leaves</span> <span class="op">~</span> <span class="va">fertilizer</span> <span class="op">*</span> <span class="va">week</span> <span class="op">+</span> <span class="fu">Error</span><span class="op">(</span><span class="va">plant</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">plantdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error: plant</span></span>
<span><span class="co">#&gt;            Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer  1   16.8   16.82     2.6   0.15</span></span>
<span><span class="co">#&gt; Residuals   8   51.7    6.46               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error: Within</span></span>
<span><span class="co">#&gt;                 Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; week             4  267.4    66.9  158.22 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; fertilizer:week  4    5.1     1.3    3.01  0.033 *  </span></span>
<span><span class="co">#&gt; Residuals       32   13.5     0.4                   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p><br></p>
<p>Although this output looks ok, remember that we need to adjust the
<em>p</em>-values for the time and interaction effects.
<strong>Why?</strong> In <code>R</code>, this requires reformatting the
data and conducting a multivariate analysis of variance (MANOVA).</p>
<p>Specifically, we need to covert the data from the “long” format that
it is currently in (each measurement on each plant is contained in its
own row) to the “wide” format (each plant is one row, with separate
columns for each weekly measurement). There are a number of ways to
convert between long and wide formats in <code>R</code> but we’ll use
the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider()</a></code> function from the <code>tidyr</code>
package<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;to run this function, we need to specify which column in
the original data frame contains the column names
(&lt;code&gt;names_from&lt;/code&gt;) and which column contains the values that will
go in the new columns (&lt;code&gt;values_from&lt;/code&gt;). We can also
(optionally) specify a prefix to add to each column name so that we
don’t end up with numeric column names. For more help, see
&lt;code&gt;&lt;a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link"&gt;?pivot_wider&lt;/a&gt;&lt;/code&gt;&lt;/p&gt;'><sup>1</sup></a>:</p>
<p><br></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plantdata_wide</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plantdata</span>, </span>
<span>                                     names_from <span class="op">=</span> <span class="va">week</span>, </span>
<span>                                     names_prefix <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>                                     values_from <span class="op">=</span> <span class="va">leaves</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plantdata_wide</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   plant fertilizer week1 week2 week3 week4 week5</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1     L              4     5     6     8    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2     L              3     4     6     6     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3     L              6     7     9    10    12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4     L              5     7     8    10    12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 5     L              5     6     7     8    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 6     H              4     6     9     9    11</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-brief-aside-about-manova">A brief aside about MANOVA<a class="anchor" aria-label="anchor" href="#a-brief-aside-about-manova"></a>
</h3>
<p>For everything that we have done up to this point (and everything we
will do later in this course), we have only considered one response
variable at a time in a model (univariate models). Other classes of
models exist, however, and we will be using one of those here
(multivariate models). Multivariate models involve estimating multiple
response variables simultaneously.</p>
<p><br></p>
<p>Remember all the way back to Lecture 2 when we discussed the basic
form of linear models. We said that:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
y_i \sim N(\mu, \sigma^2)
</annotation></semantics></math></p>
<p>which means that our response variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(y_i)</annotation></semantics></math>
is normally distributed with a mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and a variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>.</p>
<p><br></p>
<p>Now that we have more than one response variable, we will need to
modify this statement somewhat:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>N</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>i</mi></msub><mo>,</mo><mi>Σ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
Y_{ij} = N_i(\mu_i, \Sigma)
</annotation></semantics></math></p>
<p>Here we have modified this statement to represent that there are not
just one, but several (i) response variables that we are estimating each
with (j) number of observations. As a result, there is not just one
expected value, but a vector of expected values (one for each response
variable). Additionally, each response variable has its own variance
term so we no longer consider only
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>
but instead consider a matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Σ</mi><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math>
which contains the variance and covariances of each response
variable.</p>
<p>Now we can run the MANOVA:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manova1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/manova.html" class="external-link">manova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">week1</span>, <span class="va">week2</span>, <span class="va">week3</span>, <span class="va">week4</span>, <span class="va">week5</span><span class="op">)</span> <span class="op">~</span> <span class="va">fertilizer</span>, </span>
<span>                  data <span class="op">=</span> <span class="va">plantdata_wide</span><span class="op">)</span></span></code></pre></div>
<p>And the results will contain the adjusted <em>p</em>-values:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">manova1</span>, X <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, test <span class="op">=</span> <span class="st">"Spherical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Contrasts orthogonal to</span></span>
<span><span class="co">#&gt; ~1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Greenhouse-Geisser epsilon: 0.5882</span></span>
<span><span class="co">#&gt; Huynh-Feldt epsilon:        0.8490</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Df      F num Df den Df Pr(&gt;F) G-G Pr H-F Pr</span></span>
<span><span class="co">#&gt; (Intercept)  1 158.22      4     32 0.0000 0.0000 0.0000</span></span>
<span><span class="co">#&gt; fertilizer   1   3.01      4     32 0.0326 0.0666 0.0422</span></span>
<span><span class="co">#&gt; Residuals    8</span></span></code></pre></div>
<p><strong>A few things to notice here</strong></p>
<ol style="list-style-type: decimal">
<li><p>Remember that adjusting the <em>p</em>-values will only
potentially change our conclusions if the original values were
significant because his adjustment can only make the <em>p</em>-values
larger.</p></li>
<li><p>These adjusted <em>p</em>-values are only used for the time and
treatment:time interaction. Notice how <code>R</code> labels these.
<code>R</code> has labeled the ‘week’ term as <code>Intercept</code> and
the fertilizer:week interaction as <code>fertilizer</code>.</p></li>
</ol>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="profile-analysis">Profile analysis<a class="anchor" aria-label="anchor" href="#profile-analysis"></a>
</h2>
<p>A profile analysis requires calculating the differences in growth
during each time interval (i.e., the number of leaves grown each
week):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manova2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/manova.html" class="external-link">manova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">week2</span> <span class="op">-</span> <span class="va">week1</span>, <span class="va">week3</span> <span class="op">-</span> <span class="va">week2</span>, <span class="va">week4</span> <span class="op">-</span> <span class="va">week3</span>, <span class="va">week5</span> <span class="op">-</span> <span class="va">week4</span><span class="op">)</span> <span class="op">~</span> <span class="va">fertilizer</span>, data <span class="op">=</span> <span class="va">plantdata_wide</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/summary.aov.html" class="external-link">summary.aov</a></span><span class="op">(</span><span class="va">manova2</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Response 1 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; fertilizer   1    2.5     2.5    12.5 0.0077 **</span></span>
<span><span class="co">#&gt; Residuals    8    1.6     0.2                  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response 2 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer   1    1.6     1.6     3.2   0.11</span></span>
<span><span class="co">#&gt; Residuals    8    4.0     0.5               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response 3 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer   1    0.1     0.1    0.06   0.81</span></span>
<span><span class="co">#&gt; Residuals    8   12.8     1.6               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response 4 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer   1    0.1     0.1    0.09   0.77</span></span>
<span><span class="co">#&gt; Residuals    8    8.8     1.1</span></span></code></pre></div>
<p><strong>Why are there only four responses shown here even though
there are five weeks in the study?</strong></p>
<p><strong>What do these responses tell us? What does it mean that the
first is significant while the others are not?</strong></p>
<p><br></p>
<p>We can also plot the growth rates. First, calculate mean growth rate
for each time interval:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leavesMat</span> <span class="op">&lt;-</span> <span class="va">plantdata_wide</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">growthMat</span> <span class="op">&lt;-</span> <span class="va">leavesMat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">-</span> <span class="va">leavesMat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">growthMat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"interval"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, sep<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">lowFertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">growthMat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; interval.1 interval.2 interval.3 interval.4 </span></span>
<span><span class="co">#&gt;        1.2        1.4        1.2        2.2</span></span>
<span></span>
<span><span class="op">(</span><span class="va">highFertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">growthMat</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; interval.1 interval.2 interval.3 interval.4 </span></span>
<span><span class="co">#&gt;        2.2        2.2        1.0        2.0</span></span></code></pre></div>
<p>Next, calculate the standard errors for these growth rates:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">:::</span><span class="fu">vcov.mlm</span><span class="op">(</span><span class="va">manova2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="va">SE</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">SE</span><span class="op">)</span><span class="op">==</span><span class="st">":(Intercept)"</span><span class="op">]</span> <span class="co"># Only use "intercept" SEs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">SE</span><span class="op">)</span> <span class="co">## Ignore the names</span></span>
<span><span class="co">#&gt; [1] 0.2000 0.3162 0.5657 0.4690</span></span></code></pre></div>
<p>Now, create a data frame and plot the results:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growthDF</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                        fertilizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"High"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                        growth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lowFertilizer</span>, <span class="va">highFertilizer</span><span class="op">)</span>, </span>
<span>                        SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">SE</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">growthDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">interval</span>, y <span class="op">=</span> <span class="va">growth</span>, color <span class="op">=</span> <span class="va">fertilizer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">growth</span> <span class="op">-</span> <span class="va">SE</span>, ymax <span class="op">=</span> <span class="va">growth</span> <span class="op">+</span> <span class="va">SE</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Time interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Growth rate (leaves/week)"</span>, limits  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="lab11_repeated_measures_files/figure-html/unnamed-chunk-12-1.png" alt="**Figure 2: Growth rate (leaves/week) of 10 plants subjected to two fertilizer treatments. Points represent estimated values and error bars represent standard errors.**" width="576"><p class="caption">
<strong>Figure 2: Growth rate (leaves/week) of 10 plants subjected to
two fertilizer treatments. Points represent estimated values and error
bars represent standard errors.</strong>
</p>
</div>
<p><br></p>
<p><strong>What kinds of interpretations can we make from this plot?
What does it mean that the error bars do not overlap for some time
intervals (or does it necessarily mean anything)? What does the
horizontal dotted line represent and what would does it mean that all of
the estimated values are above that line?</strong></p>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="assignment-optional">Assignment (optional)<a class="anchor" aria-label="anchor" href="#assignment-optional"></a>
</h2>
<p>A researcher wants to assess the effects of crowding on the growth of
the dark toadfish (<em>Neophrynichthys latus</em>). Fifteen fish tanks
are stocked with three densities of toadfish. Five tanks have low
density (1 fish), 5 tanks have medium density (5 fish), and 5 tanks have
high density (10 fish). In each tank, the weight of one “focal fish” is
recorded on 6 consecutive weeks. The data can be loaded using:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rushinglab.github.io/FANR6750">FANR6750</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fishdata"</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Conduct the repeated measures ANOVA using <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code>.
Calculate the adjusted <em>p</em>-values using the Huynh-Feldt method.
Does the effect of density on growth change over time?</p></li>
<li><p>Conduct a profile analysis. In which time intervals is the effect
of density on growth rate significant?</p></li>
</ol>
<p>Put your answers in an R Markdown report. Your report should
include:</p>
<ol style="list-style-type: decimal">
<li><p>A well-formatted ANOVA table (with header); and</p></li>
<li><p>A publication quality plot showing the effects of crowding on the
toadfish weight across each of the time intervals in the study. The
figure should have a descriptive caption and any aesthetics (color, line
type, etc.) should be clearly defined</p></li>
</ol>
<p>You may format the report however you like but it should be
well-organized, with relevant headers, plain text, and the elements
described above.</p>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to:
<code>output: html_document</code></p></li>
<li><p>Be sure to include your first and last name in the
<code>author</code> section</p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code>
chunks so we can see both your code and the output</p></li>
<li><p>Please upload both the <code>html</code> and <code>.Rmd</code>
files when you submit your assignment</p></li>
<li><p>See the R Markdown reference sheet for help with creating
<code>R</code> chunks, equations, tables, etc.</p></li>
<li><p>See the “Creating publication-quality graphics” reference sheet
for tips on formatting figures</p></li>
</ul>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
