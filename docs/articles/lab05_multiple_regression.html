<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 5: Multiple Regression • FANR6750</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 5: Multiple Regression">
<meta property="og:description" content="FANR6750">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FANR6750</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2023.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a>
    </li>
    <li>
      <a href="../articles/lectures/01_intro_to_stats/01_intro_to_stats.html">Lecture 1: Introduction to statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/02_intro_to_lm/02_intro_to_lm.html">Lecture 2: Introduction to linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/03_inference/03_inference.html">Lecture 3: Principles of inference</a>
    </li>
    <li>
      <a href="../articles/lectures/04_t-test/04_t-test.html">Lecture 4: Linear models part 1: categorical predictor w/ 2 levels</a>
    </li>
    <li>
      <a href="../articles/lectures/05_nht/05_nht.html">Lecture 5: Null hypothesis significance testings</a>
    </li>
    <li>
      <a href="../articles/lectures/06_power/06_power.html">Lecture 6: Statistical power</a>
    </li>
    <li>
      <a href="../articles/lectures/07_anova/07_anova.html">Lecture 7: Linear models part 2: categorical predictor &gt; 2 levels</a>
    </li>
    <li>
      <a href="../articles/lectures/08_mult_comp/08_mult_comp.html">Lecture 8: Multiple Comparisons</a>
    </li>
    <li>
      <a href="../articles/lectures/09_regression/09_regression.html">Lecture 9: Multiple Regression</a>
    </li>
    <li>
      <a href="../articles/lectures/10_interactions/10_interactions.html">Lecture 10: Interactions</a>
    </li>
    <li>
      <a href="../articles/lectures/11_assumptions/11_assumptions.html">Lecture 11: Evaluating assumptions</a>
    </li>
    <li>
      <a href="../articles/lectures/12_model_selection/12_model_selection.html">Lecture 12: Model selection</a>
    </li>
    <li>
      <a href="../articles/lectures/13_random_effects/13_random_effects.html">Lecture 13: Random effects</a>
    </li>
    <li>
      <a href="../articles/lectures/14_nested/14_nested.html">Lecture 14: Nested designs</a>
    </li>
    <li>
      <a href="../articles/lectures/15_split-plot/15_split-plot.html">Lecture 15: Split-plot designs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab01_intro_to_R.html">Lab 1: Introduction to R</a>
    </li>
    <li>
      <a href="../articles/lab02_Intro_project_and_Rmd.html">Lab 2: Introduction to projects and RMarkdown</a>
    </li>
    <li>
      <a href="../articles/lab03_t-tests.html">Lab 3: t-tests</a>
    </li>
    <li>
      <a href="../articles/lab04_ANOVA.html">Lab 4: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab05_multiple_regression.html">Lab 5: Multiple Regression</a>
    </li>
    <li>
      <a href="../articles/lab06_interactions.html">Lab 6: Interactions</a>
    </li>
    <li>
      <a href="../articles/lab07_linear_model_assumptions.html">Lab 7: Evaluating assumptions</a>
    </li>
    <li>
      <a href="../articles/lab08_model_selection.html">Lab 8: Model selection</a>
    </li>
    <li>
      <a href="../articles/lab09_nested.html">Lab 9: Nested designs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework.html">Assignment instructions</a>
    </li>
    <li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/RMarkdown.html">R Markdown reference</a>
    </li>
    <li>
      <a href="../articles/graphics.html">Creating publication-quality graphics</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 5: Multiple Regression</h1>
            <h3 data-toc-skip class="subtitle">FANR 6750: Experimental
Methods in Forestry and Natural Resources Research</h3>
                        <h4 data-toc-skip class="author">Fall 2023</h4>
            
      
      
      <div class="hidden name"><code>lab05_multiple_regression.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="lab-4">Lab 4<a class="anchor" aria-label="anchor" href="#lab-4"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>ANOVA</p></li>
<li><p>Performing an ANOVA with lm() and aov()</p></li>
<li><p>Performing an ANOVA by hand</p></li>
<li><p>Plotting confidence intervals</p></li>
<li><p>Multiple comparisons</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="todays-topics">Today’s topics<a class="anchor" aria-label="anchor" href="#todays-topics"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Multiple Regression</li>
</ol>
<ul>
<li><p>ANCOVA</p></li>
<li><p>Blocking</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Centering predictors</li>
</ol>
<div class="section level4">
<h4 id="scenarios">Scenarios<a class="anchor" aria-label="anchor" href="#scenarios"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>We would like to perform an ANOVA but there is an additional
continuous predictor that is likely contributing to some of the
variation in the response.</p></li>
<li><p>We would like to perform an ANOVA but there is another grouping
variable other than our treatment that is likely contributing to some of
the variation in the response.</p></li>
<li><p>We would like to perform linear regression but we have more than
one continuous predictor (HW assignment).</p></li>
</ol>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="scenario-1-ancova">Scenario 1: ANCOVA<a class="anchor" aria-label="anchor" href="#scenario-1-ancova"></a>
</h2>
<p>Remember from lecture that an ANCOVA (Analysis of Covariance) is used
when we are interested in performing an ANOVA while first accounting for
a continuous variable. This variable may or may not be of particular
interest to us, but we would be wise to at least take it into account.
While ANCOVA is sometimes thought of as a hybrid between ANOVA and
regression, remember that all of these are just different forms of a
linear model. We could write the ANCOVA as a linear model:</p>
<p><span class="math display">\[
\Large y_{ij} = \mu + \alpha_i + \beta(x_{ij} − \bar{x}) + \epsilon_{ij}
\]</span></p>
<p><strong>How would you interpret each parameter in the context of the
data?</strong></p>
<p><strong>What would be the hypotheses related to this
model?</strong></p>
<p><br><br></p>
<div class="section level3">
<h3 id="data-example">Data example<a class="anchor" aria-label="anchor" href="#data-example"></a>
</h3>
<p>Below is a dataset which contains information about Blue Tilapia
(<em>Oreochromis aureus</em>), a species of fish which are sometimes
used in aquaponics systems. In this case, a researcher is interested in
understanding how various diet regimens affect tilapia weight (g) after
a period of 3 months. While performing this study, he would like to take
into account the length (cm) of each fish at the start of the study.
Given that longer fish tend to weigh more, he suspects that ignoring
this variable would not be appropriate.</p>
<p>Load the data and check the structure:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dietdata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dietdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    60 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ weight: num  185 217 232 238 238 ...</span></span>
<span><span class="co">#&gt;  $ diet  : Factor w/ 4 levels "Control","Low",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ length: num  11 14.8 11.9 25.6 23.2 14.1 15.9 27.1 32.1 35.5 ...</span></span>
<span><span class="co">#&gt;  $ sex   : chr  "F" "F" "M" "F" ...</span></span>
<span><span class="co">#&gt;  $ gravid: chr  "Y" NA NA "N" ...</span></span></code></pre></div>
<div class="section level4">
<h4 id="an-aside-about-factors">An aside about factors<a class="anchor" aria-label="anchor" href="#an-aside-about-factors"></a>
</h4>
<p>Factors look like character strings but they behave quite
differently, and understanding the way that <code>R</code> handles
factors is key to working with this type of data. The key difference
between factors and character strings is that factors are used to
represent <em>categorical</em> data with a fixed number of possible
values, called <em>levels</em><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>Factors can be created using the <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"adult"</span>, <span class="st">"juvenile"</span>, <span class="st">"adult"</span>, <span class="st">"juvenile"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Because we didn’t explicitly tell <code>R</code> the levels of this
factor, it will assume the levels are <em>adult</em> and
<em>juvenile</em>. Furthermore, by default <code>R</code> assigns levels
in alphabetical order, so <code>adult</code> will be the first level and
<code>juvenile</code> will be the second level:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "adult"    "juvenile"</span></span></code></pre></div>
<p>Sometimes alphabetical order might not make sense:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"medium"</span>, <span class="st">"low"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>What order will <code>R</code> assign to the treatment
levels?</strong></p>
<p><br><br></p>
<p>If you want to order the factor in a different way, you can use the
optional <code>levels</code> argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "low"    "medium" "high"</span></span></code></pre></div>
<p>Sometimes you may also need to remove factor levels. For example,
let’s see what happens if we have a typo in one of the factors:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"Male"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab05_multiple_regression_files/figure-html/unnamed-chunk-7-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Oops, one of the field techs accidentally capitalized “Male”. Let’s
change that to lowercase:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"male"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab05_multiple_regression_files/figure-html/unnamed-chunk-8-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Hmm, there’s still a bar for <code>Male</code>. We can see what’s
happening here by looking at the levels:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "female" "male"   "Male"</span></span></code></pre></div>
<p>Removing/editing the factors doesn’t change the levels! So
<code>R</code> still thinks there are three levels, just zero
<code>Male</code> entries. To remove that mis-specified level, we need
to drop it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab05_multiple_regression_files/figure-html/unnamed-chunk-10-1.png" width="384" style="display: block; margin: auto;"></p>
<p><br><br></p>
</div>
</div>
<div class="section level3">
<h3 id="back-to-the-data">Back to the data<a class="anchor" aria-label="anchor" href="#back-to-the-data"></a>
</h3>
<p>We need to change diet to a factor, and while doing so we’ll
explicitly define the level order:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dietdata</span><span class="op">$</span><span class="va">diet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dietdata</span><span class="op">$</span><span class="va">diet</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Low"</span>, <span class="st">"Med"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dietdata</span><span class="op">$</span><span class="va">diet</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Control" "Low"     "Med"     "High"</span></span></code></pre></div>
<p>Let’s also visualize the data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dietdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab05_multiple_regression_files/figure-html/unnamed-chunk-12-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dietdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diet</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab05_multiple_regression_files/figure-html/unnamed-chunk-12-2.png" width="384" style="display: block; margin: auto;"></p>
<p><br></p>
<p>And finally, let’s quantify the relationship between length and
weight using a linear regression:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">length</span>, <span class="va">dietdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = weight ~ length, data = dietdata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -56.91 -12.58   0.63  10.28  61.69 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  213.174      8.069    26.4   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; length         2.594      0.337     7.7    2e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 21.7 on 58 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.505,  Adjusted R-squared:  0.497 </span></span>
<span><span class="co">#&gt; F-statistic: 59.2 on 1 and 58 DF,  p-value: 1.99e-10</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fm1</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Term"</span>, <span class="st">"Estimate"</span>, <span class="st">"SE"</span>, <span class="st">"Statistic"</span>, <span class="st">"p-value"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Term</th>
<th align="right">Estimate</th>
<th align="right">SE</th>
<th align="right">Statistic</th>
<th align="right">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">213.174</td>
<td align="right">8.0688</td>
<td align="right">26.420</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">length</td>
<td align="right">2.594</td>
<td align="right">0.3371</td>
<td align="right">7.695</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>We can also add regression lines and CIs to our plot using the
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function:</p>
<ol style="list-style-type: decimal">
<li><p>Create a new data frame containing a sequence of values of the
predictor variable length</p></li>
<li><p>Predict weight using these values of length</p></li>
<li><p>Put predictions and data together for plotting</p></li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size</span> <span class="op">&lt;-</span> <span class="va">dietdata</span><span class="op">$</span><span class="va">length</span></span>
<span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">E1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fm1</span>, newdata <span class="op">=</span> <span class="va">nd</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span>, interval<span class="op">=</span><span class="st">"confidence"</span><span class="op">)</span></span>
<span><span class="va">predictionData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">E1</span><span class="op">$</span><span class="va">fit</span>, <span class="va">nd</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dietdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predictionData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predictionData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">fit</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="lab05_multiple_regression_files/figure-html/unnamed-chunk-15-1.png" width="384" style="display: block; margin: auto;"></p>
<p><strong>Note that in this simple case, you could use the built in
<code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth()</a></code> in <code>ggplot2</code> to plot the
regression line, though that will not always work.
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> is a more general method for creating and
plotting regression lines from fitted models.</strong></p>
<p><br></p>
<p>It’s clear that there is a strong, positive relationship between
length and weight. If we want to quantify whether there is an effect of
diet on weight, we will clearly need to control for length in our
analysis.</p>
<p>As an aside, let’s see what happens if we had ignored length and
simply performed a one-way ANOVA.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">weight</span><span class="op">~</span> <span class="va">diet</span>, data<span class="op">=</span> <span class="va">dietdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; diet         3   5459    1820    2.05   0.12</span></span>
<span><span class="co">#&gt; Residuals   56  49734     888</span></span></code></pre></div>
<p><strong>Notice that we conclude that there is not a difference in
weights as a function of diet type even though later in the lab, we will
see that diet is an important factor. Why do we reach this incorrect
conclusion here?</strong></p>
<p><br><br><br></p>
<p>Now we are ready to perform the ANCOVA. To make interpretation
simpler, we will center the continuous predictor.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dietdata</span><span class="op">$</span><span class="va">length_centered</span> <span class="op">&lt;-</span> <span class="va">dietdata</span><span class="op">$</span><span class="va">length</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dietdata</span><span class="op">$</span><span class="va">length</span><span class="op">)</span></span>
<span><span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">weight</span><span class="op">~</span> <span class="va">length_centered</span> <span class="op">+</span> <span class="va">diet</span>, data<span class="op">=</span> <span class="va">dietdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = weight ~ length_centered + diet, data = dietdata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -38.25 -12.18  -2.53  12.15  49.23 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)      253.967      4.875   52.10  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; length_centered    2.789      0.297    9.38  5.2e-13 ***</span></span>
<span><span class="co">#&gt; dietLow           13.727      6.878    2.00  0.05091 .  </span></span>
<span><span class="co">#&gt; dietMed           25.226      6.974    3.62  0.00065 ***</span></span>
<span><span class="co">#&gt; dietHigh          30.784      6.833    4.51  3.5e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 18.6 on 55 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.654,  Adjusted R-squared:  0.628 </span></span>
<span><span class="co">#&gt; F-statistic: 25.9 on 4 and 55 DF,  p-value: 4.14e-12</span></span></code></pre></div>
<p><strong>How would you interpret each of these parameter estimates in
the context of the data?</strong></p>
<p><br><br></p>
<p>As before, we can create predictions of weight over a sequences of
lengths, for every level of diet:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lengthC</span> <span class="op">&lt;-</span> <span class="va">dietdata</span><span class="op">$</span><span class="va">length_centered</span></span>
<span><span class="va">nd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>diet<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Low"</span>, <span class="st">"Med"</span>, <span class="st">"High"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>                  length_centered<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lengthC</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lengthC</span><span class="op">)</span>,length <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">E2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fm2</span>, newdata<span class="op">=</span><span class="va">nd2</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span>
<span><span class="va">predData2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">E2</span><span class="op">$</span><span class="va">fit</span>, <span class="va">nd2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dietdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length_centered</span>, y <span class="op">=</span> <span class="va">weight</span>, color <span class="op">=</span> <span class="va">diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length_centered</span>, y <span class="op">=</span> <span class="va">fit</span>, color <span class="op">=</span> <span class="va">diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>reverse<span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Weight"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Length"</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab05_multiple_regression_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
<p><br><br></p>
<p>We can also look at multiple comparisons. Note that because we used
the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function instead of <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code>, we are not
able to use <code><a href="https://rdrr.io/r/stats/TukeyHSD.html" class="external-link">TukeyHSD()</a></code> as we did before. Instead we can use
<code><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht()</a></code> function from the <code>multcomp</code> package.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org" class="external-link">multcomp</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">fm2</span>, linfct<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>diet<span class="op">=</span><span class="st">"Tukey"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Tukey Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lm(formula = weight ~ length_centered + diet, data = dietdata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;                     Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; Low - Control == 0     13.73       6.88    2.00   0.2019    </span></span>
<span><span class="co">#&gt; Med - Control == 0     25.23       6.97    3.62   0.0035 ** </span></span>
<span><span class="co">#&gt; High - Control == 0    30.78       6.83    4.51   &lt;0.001 ***</span></span>
<span><span class="co">#&gt; Med - Low == 0         11.50       6.83    1.68   0.3419    </span></span>
<span><span class="co">#&gt; High - Low == 0        17.06       6.82    2.50   0.0710 .  </span></span>
<span><span class="co">#&gt; High - Med == 0         5.56       6.87    0.81   0.8500    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span></code></pre></div>
<p><br><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="scenario-2-blocking">Scenario 2: Blocking<a class="anchor" aria-label="anchor" href="#scenario-2-blocking"></a>
</h2>
<p>Blocking is used when an additional factor besides our treatment of
interest may be contributing to variation in the response variable.
While blocking is usually thought of in the context of an ANOVA, it can
be used in other linear modeling situations as well.</p>
<p>Blocks can be regions, time periods, individual subjects, etc. but
blocking must occur <strong>during the design phase</strong> of the
study. (Later in the course, we will discuss the scenario where we are
interested in this second factor and we will no longer refer to it as a
block.)</p>
<p>We can write the additive Randomized Complete Block Design as:</p>
<p><span class="math display">\[\large y_{ij} = \mu + \alpha_i + \beta_j
+ \epsilon_{ij}\]</span></p>
<p><strong>What would be the hypotheses related to this
model?</strong></p>
<div class="section level3">
<h3 id="blocked-anova-by-hand">Blocked ANOVA by hand<a class="anchor" aria-label="anchor" href="#blocked-anova-by-hand"></a>
</h3>
<p>To “fit” the RCBD model by hand, we’ll use the gypsy moth data we saw
in lecture. In this dataset a researcher has counted the number of
caterpillars in each plot treated with either Bt or Dimilin (or left as
a control). Additionally, because the treated plots were located in 4
geographic regions, region has been included as a block in the
model.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mothdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">Region</th>
<th align="center">Treatment</th>
<th align="center">Larvae</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">Control</td>
<td align="center">25</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">Bt</td>
<td align="center">16</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">Dimilin</td>
<td align="center">14</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">Control</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">Bt</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">Dimilin</td>
<td align="center">2</td>
</tr>
</tbody>
</table>
<p>Before we analyze the moth data, we need to tell <code>R</code> to
treat the <code>Treatment</code> and <code>Region</code> variables as
factors:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [12 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ Region   : Factor w/ 4 levels "1","2","3","4": 1 1 1 2 2 2 3 3 3 4 ...</span></span>
<span><span class="co">#&gt;  $ Treatment: Factor w/ 3 levels "Control","Bt",..: 1 2 3 1 2 3 1 2 3 1 ...</span></span>
<span><span class="co">#&gt;  $ Larvae   : num [1:12] 25 16 14 10 3 2 15 10 16 32 ...</span></span></code></pre></div>
<p>Right now, they are character and integer objects, respectively.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothdata</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Treatment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Bt"</span>, <span class="st">"Dimilin"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Control" "Bt"      "Dimilin"</span></span>
<span></span>
<span><span class="va">mothdata</span><span class="op">$</span><span class="va">Region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1" "2" "3" "4"</span></span></code></pre></div>
<p>Note that we were explicit about the order of levels for
<code>Treatment</code> so that control came first.</p>
<div class="section level4">
<h4 id="means">Means<a class="anchor" aria-label="anchor" href="#means"></a>
</h4>
<p>Next, compute the means:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Grand mean</span></span>
<span><span class="op">(</span><span class="va">grand.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Larvae</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 14.42</span></span>
<span></span>
<span><span class="co"># Treatment means</span></span>
<span><span class="op">(</span><span class="va">treatment.means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">mothdata</span>, <span class="va">Treatment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Larvae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   Treatment    mu</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Control    20.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Bt         11.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Dimilin    11</span></span>
<span></span>
<span><span class="co"># Block means</span></span>
<span><span class="op">(</span><span class="va">block.means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">mothdata</span>, <span class="va">Region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Larvae</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   Region    mu</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       18.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2        5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3       13.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4       20.7</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="treatment-sums-of-squares">Treatment sums of squares<a class="anchor" aria-label="anchor" href="#treatment-sums-of-squares"></a>
</h4>
<p>The formula for the treatment sums of squares:</p>
<p><span class="math display">\[\Large b \times \sum_{i=1}^a (\bar{y}_i
- \bar{y}_.)^2\]</span></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nlevels.html" class="external-link">nlevels</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">SS.treat</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">treatment.means</span><span class="op">$</span><span class="va">mu</span> <span class="op">-</span> <span class="va">grand.mean</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 223.2</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="block-sums-of-squares">Block sums of squares<a class="anchor" aria-label="anchor" href="#block-sums-of-squares"></a>
</h4>
<p>The formula for the block sums of squares:</p>
<p><span class="math display">\[\Large a \times \sum_{j=1}^b (\bar{y}_j
- \bar{y}_.)^2\]</span></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nlevels.html" class="external-link">nlevels</a></span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">SS.block</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">block.means</span><span class="op">$</span><span class="va">mu</span> <span class="op">-</span> <span class="va">grand.mean</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 430.9</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="within-groups-sums-of-squares">Within groups sums of squares<a class="anchor" aria-label="anchor" href="#within-groups-sums-of-squares"></a>
</h4>
<p><span class="math display">\[\Large \sum_{i=1}^a \sum_{j=1}^b (y_{ij}
- \bar{y}_i - \bar{y}_j + \bar{y}_.)^2\]</span></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment.means.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">treatment.means</span><span class="op">$</span><span class="va">mu</span>, times <span class="op">=</span> <span class="va">b</span><span class="op">)</span></span>
<span><span class="va">block.means.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">block.means</span><span class="op">$</span><span class="va">mu</span>, each <span class="op">=</span> <span class="va">a</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">SS.within</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">mothdata</span><span class="op">$</span><span class="va">Larvae</span> <span class="op">-</span> <span class="va">treatment.means.long</span> <span class="op">-</span> <span class="va">block.means.long</span> <span class="op">+</span> <span class="va">grand.mean</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 114.8</span></span></code></pre></div>
<p><strong>NOTE: For the above code to work,
<code>treatment.means</code> and <code>block.means</code> must be in the
same order as in the original data.</strong></p>
</div>
<div class="section level4">
<h4 id="create-anova-table">Create ANOVA table<a class="anchor" aria-label="anchor" href="#create-anova-table"></a>
</h4>
<p>Now we’re ready to create the ANOVA table. Start with what we’ve
calculated so far:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df.treat</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">df.block</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">df.within</span> <span class="op">&lt;-</span> <span class="va">df.treat</span><span class="op">*</span><span class="va">df.block</span></span>
<span><span class="va">ANOVAtable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df.treat</span>, <span class="va">df.block</span>, <span class="va">df.within</span><span class="op">)</span>,</span>
<span>                         SS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">SS.treat</span>, <span class="va">SS.block</span>, <span class="va">SS.within</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">ANOVAtable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Treatment"</span>, <span class="st">"Block"</span>, <span class="st">"Within"</span><span class="op">)</span></span>
<span><span class="va">ANOVAtable</span></span>
<span><span class="co">#&gt;           df    SS</span></span>
<span><span class="co">#&gt; Treatment  2 223.2</span></span>
<span><span class="co">#&gt; Block      3 430.9</span></span>
<span><span class="co">#&gt; Within     6 114.8</span></span></code></pre></div>
<p>Next, add the mean squares:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MSE</span> <span class="op">&lt;-</span> <span class="va">ANOVAtable</span><span class="op">$</span><span class="va">SS</span> <span class="op">/</span> <span class="va">ANOVAtable</span><span class="op">$</span><span class="va">df</span></span>
<span><span class="va">ANOVAtable</span><span class="op">$</span><span class="va">MSE</span> <span class="op">&lt;-</span> <span class="va">MSE</span> <span class="co">## makes a new column!</span></span></code></pre></div>
<p>Now, the <em>F</em>-values (with <code>NA</code> for
error/within/residual row):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">F.stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">MSE</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">MSE</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">MSE</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">MSE</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">ANOVAtable</span><span class="op">$</span><span class="va">F.stat</span> <span class="op">&lt;-</span> <span class="va">F.stat</span></span></code></pre></div>
<p>Finally, the <em>p</em>-values</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">pf</a></span><span class="op">(</span><span class="va">F.stat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">pf</a></span><span class="op">(</span><span class="va">F.stat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">ANOVAtable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span></span></code></pre></div>
<hr>
<p>Quick reminder about calculating <em>p</em>-values</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">qf</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span> <span class="co"># 95% of the distribution is below this value of F</span></span>
<span><span class="co">#&gt; [1] 5.143</span></span>
<span></span>
<span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">pf</a></span><span class="op">(</span><span class="va">F.stat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span> <span class="co"># Proportion of the distribution beyond this F value</span></span>
<span><span class="co">#&gt; [1] 0.03922</span></span></code></pre></div>
<p>Be sure you understand what each of these functions is doing!</p>
<hr>
<p>And we’ll display the table using <code><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable()</a></code>, with a few
options to make it look a little nicer:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>knitr.kable.NA <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="co"># leave NA cells empty</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">ANOVAtable</span>, digits <span class="op">=</span> <span class="fl">2</span>, align <span class="op">=</span> <span class="st">"c"</span>,</span>
<span>             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"df"</span>, <span class="st">"SS"</span>, <span class="st">"MSE"</span>, <span class="st">"F"</span>, <span class="st">"p-value"</span><span class="op">)</span>,</span>
<span>             caption <span class="op">=</span> <span class="st">"RCBD ANOVA table calculated by hand"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>RCBD ANOVA table calculated by hand</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">df</th>
<th align="center">SS</th>
<th align="center">MSE</th>
<th align="center">F</th>
<th align="center">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Treatment</td>
<td align="center">2</td>
<td align="center">223.2</td>
<td align="center">111.58</td>
<td align="center">5.83</td>
<td align="center">0.04</td>
</tr>
<tr class="even">
<td align="left">Block</td>
<td align="center">3</td>
<td align="center">430.9</td>
<td align="center">143.64</td>
<td align="center">7.51</td>
<td align="center">0.02</td>
</tr>
<tr class="odd">
<td align="left">Within</td>
<td align="center">6</td>
<td align="center">114.8</td>
<td align="center">19.14</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="blocked-anova-using-aov">Blocked ANOVA using <code>aov()</code><a class="anchor" aria-label="anchor" href="#blocked-anova-using-aov"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">Larvae</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Region</span>, <span class="va">mothdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov1</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)  </span></span>
<span><span class="co">#&gt; Treatment    2    223   111.6    5.83  0.039 *</span></span>
<span><span class="co">#&gt; Region       3    431   143.6    7.51  0.019 *</span></span>
<span><span class="co">#&gt; Residuals    6    115    19.1                 </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Look what happens if we ignore the blocking variable though:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">Larvae</span> <span class="op">~</span> <span class="va">Treatment</span>, <span class="va">mothdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov2</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; Treatment    2    223   111.6    1.84   0.21</span></span>
<span><span class="co">#&gt; Residuals    9    546    60.6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="blocked-anova-using-lm">Blocked ANOVA using <code>lm()</code><a class="anchor" aria-label="anchor" href="#blocked-anova-using-lm"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Larvae</span><span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Region</span>, <span class="va">mothdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Larvae ~ Treatment + Region, data = mothdata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -5.250 -1.021  0.167  0.604  5.750 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                  Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)         24.42       3.09    7.89  0.00022 ***</span></span>
<span><span class="co">#&gt; TreatmentBt         -8.75       3.09   -2.83  0.03001 *  </span></span>
<span><span class="co">#&gt; TreatmentDimilin    -9.50       3.09   -3.07  0.02191 *  </span></span>
<span><span class="co">#&gt; Region2            -13.33       3.57   -3.73  0.00971 ** </span></span>
<span><span class="co">#&gt; Region3             -4.67       3.57   -1.31  0.23924    </span></span>
<span><span class="co">#&gt; Region4              2.33       3.57    0.65  0.53782    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 4.37 on 6 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.851,  Adjusted R-squared:  0.726 </span></span>
<span><span class="co">#&gt; F-statistic: 6.84 on 5 and 6 DF,  p-value: 0.0183</span></span></code></pre></div>
<p><strong>Can you interpret each parameter estimate from the output of
aov1 and lm1? What different information is provided from these two ways
of constructing the model? Which null hypotheses were rejected? Failed
to be rejected?</strong></p>
<p><br><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="assignment-not-for-a-grade">Assignment (not for a grade)<a class="anchor" aria-label="anchor" href="#assignment-not-for-a-grade"></a>
</h2>
<p>Some time ago, plantations of <em>Pinus caribaea</em> were
established at four locations on Puerto Rico. As part of a study, four
spacing intervals were used at each location to determine the effect of
spacing on tree height. Twenty years after the plantations were
established, measurements (height in ft) were made in the study plots.
Additionally, soil chemistry was analyzed to determine average pH and
nitrogen content (mg N/kg soil) for each tree. Note that although
spacing interval is a number, it must be treated as a factor since these
4 spacing intervals (and only these 4) are of interest to the
researcher.</p>
<p>You can access these data using:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pinedata"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Questions/tasks</strong></p>
<p>The researcher would like you to develop several models to
investigate the variables affecting tree height in the plantations. When
you have done this, she asks that you submit a report of your findings.
Instructions for the report are shown below.</p>
<ol style="list-style-type: decimal">
<li>
<p>Construct a model using the lm() function which predicts tree
height as a function of spacing and, because the researcher is also
interested in seeing if soil pH is contributing to differences in tree
height, include pH as a predictor as well. You may choose to center the
continuous variable or not, but remember that it will affect the way you
interpret the results.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Write out the hypotheses associated with this model</p></li>
<li><p>Use the equation editor to show the linear model you would use
and interpret each term.</p></li>
<li><p>State your model conclusions in the context of the data. Does
there appear to be a relationship between tree height and tree
spacing.</p></li>
<li><p>Determine which tree spacings differ from eachother with regard
to their effect on tree height.</p></li>
<li><p>Create a publication quality plot displaying the effect that pH
and tree spacing has on tree height. The figure should have a
descriptive caption and any aesthetics (color, line type, etc.) should
be clearly defined.</p></li>
</ol>
</li>
<li>
<p>Construct an ANOVA table by hand which shows the relationship
between tree height and spacing as well as the other categorical
variable of location. The researcher is not particularly interested in
geographic location and she’s not sure of the exact mechanism, but she
thinks it may affect the results.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Create a well formatted ANOVA table with a table header using
available R functions.</p></li>
<li><p>Was it necessary to include location in your model? Would it have
changed your overall conclusions about the effect of spacing on tree
height if you had not included it?</p></li>
</ol>
</li>
<li>
<p>Construct a model using the lm() function that predicts tree
height as a function of soil pH and nitrogen content.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Write out the hypotheses associated with this model</p></li>
<li><p>Use the equation editor to show the linear model you would use
and interpret each term.</p></li>
<li><p>Interpret each parameter estimate in the model output</p></li>
</ol>
</li>
<li><p>Discussion: Up to now, we have discussed how we might construct
several types of models which are all being used to predict tree height
in this data scenario. Later in the semester we will talk about ‘model
selection’ which is the process of choosing one model out of several
that somehow best represents the research system. Having no formal
instruction on this topic yet (or perhaps you do) explain how you think
model selection might be done. What kinds of metrics might you use to
decide which model best represents the data? (There is no one right
answer here and all reasonably thought out answers will be
accepted.)</p></li>
</ol>
<p>You may format the report however you like but it should be
well-organized, with relevant headers, plain text, and the elements
described above.</p>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to:
<code>output: html_document</code></p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code>
chunks</p></li>
<li><p>See the R Markdown reference sheet for help with creating
<code>R</code> chunks, equations, tables, etc.</p></li>
<li><p>See the “Creating publication-quality graphics” reference sheet
for tips on formatting figures</p></li>
</ul>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Under the hood, <code>R</code> actually treats factors
as integers - 1, 2, 3… - with character labels for each level<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
