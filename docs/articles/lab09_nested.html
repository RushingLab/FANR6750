<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lab 9: Nested ANOVA • FANR6750</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lab 9: Nested ANOVA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FANR6750</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2025.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../articles/syllabus.html"><span class="fa fas fa-book"></span> Syllabus</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/schedule.html"><span class="fa fas fa-calendar"></span> Schedule</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lectures" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-file-pdf-o"></span> Lectures</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lectures">
<li><a class="dropdown-item" href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/01_intro_to_stats/01_intro_to_stats.html">Lecture 1: Introduction to statistics</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/02_intro_to_lm/02_intro_to_lm.html">Lecture 2: Introduction to linear models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/03_inference/03_inference.html">Lecture 3: Principles of inference</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/04_principles_of_expdesign/04_expdesign.html">Lecture 4: Principles of experimental design</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/05_t-test/05_t-test.html">Lecture 5: Linear models part 1: categorical predictor w/ 2 levels</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/06_nht/06_nht.html">Lecture 6: Null hypothesis significance testings</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/07_power/07_power.html">Lecture 7: Statistical power</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/08_anova/08_anova.html">Lecture 8: Linear models part 2: categorical predictor &gt; 2 levels</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/09_mult_comp/09_mult_comp.html">Lecture 9: Multiple Comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/10_regression/10_regression.html">Lecture 10: Multiple Regression</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-labs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-desktop"></span> Labs</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-labs">
<li><a class="dropdown-item" href="../articles/lab01_intro_to_R.html">Lab 1: Introduction to R</a></li>
    <li><a class="dropdown-item" href="../articles/lab02_Intro_project_and_Rmd.html">Lab 2: Introduction to projects and RMarkdown</a></li>
    <li><a class="dropdown-item" href="../articles/lab03_inference.html">Lab 3: Using R to explore sampling error</a></li>
    <li><a class="dropdown-item" href="../articles/lab04_t-tests.html">Lab 4: t-tests</a></li>
    <li><a class="dropdown-item" href="../articles/lab05_ANOVA.html">Lab 5: ANOVA</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-references" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-pencil-square-o"></span> References</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-references">
<li><a class="dropdown-item" href="../articles/homework.html">Assignment instructions</a></li>
    <li><a class="dropdown-item" href="../articles/projects_and_directories.html">Projects and directories</a></li>
    <li><a class="dropdown-item" href="../articles/RMarkdown.html">R Markdown reference</a></li>
    <li><a class="dropdown-item" href="../articles/graphics.html">Creating publication-quality graphics</a></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Lab 9: Nested ANOVA</h1>
            <h3 data-toc-skip class="subtitle">FANR 6750: Experimental
Methods in Forestry and Natural Resources Research</h3>
                        <h4 data-toc-skip class="author">Fall 2024</h4>
            
      

      <div class="d-none name"><code>lab09_nested.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="lab-8">Lab 8<a class="anchor" aria-label="anchor" href="#lab-8"></a>
</h3>
<ul>
<li>
<p>Model selection</p>
<ul>
<li><p>Exploration</p></li>
<li><p>Prediction</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="todays-topics">Today’s topics<a class="anchor" aria-label="anchor" href="#todays-topics"></a>
</h3>
<ul>
<li>
<p>Nested ANOVA</p>
<ul>
<li><p>Specifying the model</p></li>
<li><p>Hypotheses</p></li>
<li><p>Random effects</p></li>
<li><p>lme() function</p></li>
</ul>
</li>
</ul>
<p><br></p>
</div>
<div class="section level2">
<h2 id="scenario">Scenario<a class="anchor" aria-label="anchor" href="#scenario"></a>
</h2>
<p>Remember from lecture that nested designs are useful in situations
where we subsample within each experimental unit and we’re interested in
treatment effects at the experimental (whole) unit level, not the
subunit level. For example:</p>
<ul>
<li><p>We count larvae at multiple subplots within a plot</p></li>
<li><p>We weigh multiple chicks in a brood</p></li>
<li><p>We measure shrub growth at multiple subplots within a
plot</p></li>
</ul>
<p><br></p>
<div class="section level3">
<h3 id="the-additive-model">The additive model<a class="anchor" aria-label="anchor" href="#the-additive-model"></a>
</h3>
<p><span class="math display">$$\Large y_{ijk} = \mu + \alpha_i +
\beta_{ij} + \epsilon_{ijk}$$</span></p>
<p><strong>Can you define all of the terms in the linear model? Why do
we need so many subscripts?</strong></p>
<p><br></p>
<p><span class="math display">$$\Large \beta_{ij} \sim normal(0,
\sigma^2_B)$$</span></p>
<p>And as always,</p>
<p><span class="math display">$$\Large \epsilon_{ijk} \sim normal(0,
\sigma^2)$$</span></p>
</div>
<div class="section level3">
<h3 id="hypotheses">Hypotheses<a class="anchor" aria-label="anchor" href="#hypotheses"></a>
</h3>
<p>Treatment effects:</p>
<p><span class="math display">$$\Large H_0 : \alpha_1 = · · · = \alpha_a
= 0$$</span> <span class="math display">$$\Large H_a : at\; least\;
one\; inequality$$</span> Random variation among experimental units:</p>
<p><span class="math display">$$\Large H_0 : \sigma^2_B = 0$$</span></p>
<p><span class="math display">$$\Large H_a : \sigma^2_B &gt;
0$$</span></p>
<p>Note: Here we have referred to the variance term as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>B</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_B</annotation></semantics></math>
but we could use any reasonable subscript to refer to the variance term
for the random effect.</p>
<p>Note: Recall that a nested ANOVA is primarily used when the variation
among experimental units is of interest. If this variation was not of
interest or if we had reason to believe that all the experimental units
did not differ from eachother, we can simplify to a one-way ANOVA.</p>
</div>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>For this lab, we’ll use another data set on the response of gypsy
moth larvae to pesticide treatments:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mothdata2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mothdata2</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    36 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ larvae   : num  16 16 15.8 14.2 13.9 14.2 13.5 13.4 14 13.1 ...</span></span>
<span><span class="co">#&gt;  $ Treatment: chr  "Bt" "Bt" "Bt" "Bt" ...</span></span>
<span><span class="co">#&gt;  $ Plot     : int  1 1 1 1 2 2 2 2 3 3 ...</span></span></code></pre></div>
<p>As before, we’ll need to convert <code>Plot</code> and
<code>Treatment</code> to be factors:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mothdata2</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mothdata2</span><span class="op">$</span><span class="va">Treatment</span>, </span>
<span>                              levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Bt"</span>, <span class="st">"Dimilin"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mothdata2</span><span class="op">$</span><span class="va">Plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mothdata2</span><span class="op">$</span><span class="va">Plot</span><span class="op">)</span></span></code></pre></div>
<p>Note that we explicitly define the levels for <code>Treatment</code>
so that control will be treated as the baseline level and plotted first.
We don’t need to do that with <code>Plot</code> since the default
numeric order is fine.</p>
<p>To see the level of replication within each treatment and plot, let’s
cross-tabulate the data. It is a good idea to check this since
unbalanced designs generally require some additionl thought.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">mothdata2</span><span class="op">$</span><span class="va">Treatment</span>, <span class="va">mothdata2</span><span class="op">$</span><span class="va">Plot</span><span class="op">)</span></span>
<span><span class="co">#&gt;          </span></span>
<span><span class="co">#&gt;           1 2 3 4 5 6 7 8 9</span></span>
<span><span class="co">#&gt;   Control 0 0 0 4 4 4 0 0 0</span></span>
<span><span class="co">#&gt;   Bt      4 4 4 0 0 0 0 0 0</span></span>
<span><span class="co">#&gt;   Dimilin 0 0 0 0 0 0 4 4 4</span></span></code></pre></div>
<hr>
<p>Notice how plots are labeled! Not according to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>∈</mo><mrow><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn></mrow></mrow><annotation encoding="application/x-tex">j \in {1, 2, 3}</annotation></semantics></math>,
even though there are three plots within each treatment (and four
replicates within each plot). Rather, each plot is labeled
independently, 1–9.</p>
<p>Why is this important?</p>
<hr>
</div>
<div class="section level3">
<h3 id="analysis-using-aov">Analysis using <code>aov()</code><a class="anchor" aria-label="anchor" href="#analysis-using-aov"></a>
</h3>
<p>Based on the models we’ve fit previously this semester, we might
instinctively analyze these data using the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov.wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Plot</span>, data <span class="op">=</span> <span class="va">mothdata2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov.wrong</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Treatment    2  215.4   107.7  208.89 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Plot         6   11.2     1.9    3.61 0.0093 ** </span></span>
<span><span class="co">#&gt; Residuals   27   13.9     0.5                   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>But if we do so, the <strong>denominator degrees of freedom are
incorrect</strong>. Instead, we should use:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="fu">Error</span><span class="op">(</span><span class="va">Plot</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mothdata2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov.correct</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error: Plot</span></span>
<span><span class="co">#&gt;           Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Treatment  2  215.4   107.7    57.9 0.00012 ***</span></span>
<span><span class="co">#&gt; Residuals  6   11.2     1.9                    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error: Within</span></span>
<span><span class="co">#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; Residuals 27   13.9   0.516</span></span></code></pre></div>
<p>Can you spot the difference? What calculations changed between these
two analyses?</p>
<p><br><br></p>
<p>Note: The next few code chunks are not necessary. They are simply
demonstrating that what we are doing here is exactly the same as
performing a one way ANOVA after averaging across the subunits.</p>
<p>What happens if we analyze plot-level means? The
<code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code> function is similar to <code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply()</a></code>
but it works on entire data frames. Here we get averages for each whole
plot:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Plot</span>, </span>
<span>                      data <span class="op">=</span> <span class="va">mothdata2</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">plotData</span></span>
<span><span class="co">#&gt;   Treatment Plot larvae</span></span>
<span><span class="co">#&gt; 1        Bt    1  15.50</span></span>
<span><span class="co">#&gt; 2        Bt    2  13.75</span></span>
<span><span class="co">#&gt; 3        Bt    3  14.00</span></span>
<span><span class="co">#&gt; 4   Control    4  18.25</span></span>
<span><span class="co">#&gt; 5   Control    5  18.75</span></span>
<span><span class="co">#&gt; 6   Control    6  19.25</span></span>
<span><span class="co">#&gt; 7   Dimilin    7  12.50</span></span>
<span><span class="co">#&gt; 8   Dimilin    8  13.50</span></span>
<span><span class="co">#&gt; 9   Dimilin    9  13.00</span></span></code></pre></div>
<p>When we use <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code> to analyze the aggregated data, we get
the same <em>F</em> and <em>p</em> as before:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span>, data <span class="op">=</span> <span class="va">plotData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov.plot</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; Treatment    2   53.8   26.92    57.9 0.00012 ***</span></span>
<span><span class="co">#&gt; Residuals    6    2.8    0.47                    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="issues-with-analyzing-nested-data">Issues with analyzing nested data<a class="anchor" aria-label="anchor" href="#issues-with-analyzing-nested-data"></a>
</h3>
<p>When using using <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code> with Error term:</p>
<ul>
<li><p>You can’t use <code><a href="https://rdrr.io/r/stats/TukeyHSD.html" class="external-link">TukeyHSD()</a></code></p></li>
<li><p>You don’t get a direct estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>B</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_B</annotation></semantics></math></p></li>
<li><p>Doesn’t handle unbalanced designs well</p></li>
<li><p>But, you can use <code><a href="https://rdrr.io/r/stats/model.tables.html" class="external-link">model.tables()</a></code></p></li>
</ul>
<p><br></p>
<p>An alternative is to use the <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code> function in the
<code>nlme</code> package (which is designed for mixed effects
models)</p>
<ul>
<li><p>Possible to get direct estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>B</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_B</annotation></semantics></math>
and other variance parameters</p></li>
<li><p>Handles very complex models and unbalanced designs</p></li>
<li><p>Possible to do multiple comparisons and contrasts using the
<code><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht()</a></code> function in the <code>multcomp</code>
package</p></li>
</ul>
<p>But…</p>
<ul>
<li><p>Only works if there are random effects</p></li>
<li><p>ANOVA tables aren’t as complete as <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code></p></li>
</ul>
</div>
<div class="section level3">
<h3 id="using-the-lme-function">Using the <code>lme()</code> function<a class="anchor" aria-label="anchor" href="#using-the-lme-function"></a>
</h3>
<p>To see how the <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code> function works let’s fit the moth
data model using this approach:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org" class="external-link">multcomp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">lme1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span>, random <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span>, data <span class="op">=</span> <span class="va">mothdata2</span><span class="op">)</span></span></code></pre></div>
<p>The syntax for random effects can be a little confusing at first but
see <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">?lme</a></code> for additional information.</p>
<p>Now we can view the ANOVA table from the model using:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lme1</span>, Terms <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span></span>
<span><span class="co">#&gt; F-test for: Treatment </span></span>
<span><span class="co">#&gt;   numDF denDF F-value p-value</span></span>
<span><span class="co">#&gt; 1     2     6   57.87   1e-04</span></span></code></pre></div>
<p>You’ll notice that it is a very simplified version of the ANOVA
table. It only provides us with one line which relates to the
treatment.</p>
<p>And we can view the variance parameter estimates:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html" class="external-link">VarCorr</a></span><span class="op">(</span><span class="va">lme1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plot = pdLogChol(1) </span></span>
<span><span class="co">#&gt;             Variance StdDev</span></span>
<span><span class="co">#&gt; (Intercept) 0.3364   0.580 </span></span>
<span><span class="co">#&gt; Residual    0.5156   0.718</span></span></code></pre></div>
<p>The first row shows the estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>B</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_B</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>B</mi></msub><annotation encoding="application/x-tex">\sigma_B</annotation></semantics></math>.
These are redundant values since one can be calculated from the other.
The second row shows the estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.</p>
<p><br><br></p>
<p><strong>What can we say about the amount of random variation within
whole units relative to among whole units (after accounting for
treatment effects)? Does it appear that in this scenario the random
effect of plot was necessary?</strong></p>
<p>Note that we will reject the null hypothesis related to the variance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>B</mi><mn>2</mn></msubsup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\sigma^2_B = 0</annotation></semantics></math>)
if the F-statistic
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mi>M</mi><msub><mi>S</mi><mi>B</mi></msub></mrow><mrow><mi>M</mi><msub><mi>S</mi><mi>E</mi></msub></mrow></mfrac><annotation encoding="application/x-tex">\frac{MS_B}{MS_E}</annotation></semantics></math>)
&gt;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mrow><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>a</mi><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>α</mi></mrow></msub><annotation encoding="application/x-tex">F_{a(b-1), ab(n-1),\alpha}</annotation></semantics></math>.
Keep in mind though that to get this F-statistic, we will need to use
the aov() function approach.</p>
<p><br></p>
<p>Next, we can extract the plot-level random effects. These are the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{ij}</annotation></semantics></math>’s:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">lme1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   (Intercept)</span></span>
<span><span class="co">#&gt; 1        0.78</span></span>
<span><span class="co">#&gt; 2       -0.48</span></span>
<span><span class="co">#&gt; 3       -0.30</span></span>
<span><span class="co">#&gt; 4       -0.36</span></span>
<span><span class="co">#&gt; 5        0.00</span></span>
<span><span class="co">#&gt; 6        0.36</span></span>
<span><span class="co">#&gt; 7       -0.36</span></span>
<span><span class="co">#&gt; 8        0.36</span></span>
<span><span class="co">#&gt; 9        0.00</span></span></code></pre></div>
<p>And finally, multiple comparisons:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tuk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">glht</a></span><span class="op">(</span><span class="va">lme1</span>, linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html" class="external-link">mcp</a></span><span class="op">(</span>Treatment<span class="op">=</span><span class="st">"Tukey"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tuk</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Tukey Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lme.formula(fixed = larvae ~ Treatment, data = mothdata2, random = ~1 | </span></span>
<span><span class="co">#&gt;     Plot)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;                        Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Bt - Control == 0        -4.333      0.557   -7.78   &lt;0.001 ***</span></span>
<span><span class="co">#&gt; Dimilin - Control == 0   -5.750      0.557  -10.32   &lt;0.001 ***</span></span>
<span><span class="co">#&gt; Dimilin - Bt == 0        -1.417      0.557   -2.54     0.03 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">tuk</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Simultaneous Confidence Intervals</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple Comparisons of Means: Tukey Contrasts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit: lme.formula(fixed = larvae ~ Treatment, data = mothdata2, random = ~1 | </span></span>
<span><span class="co">#&gt;     Plot)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Quantile = 2.343</span></span>
<span><span class="co">#&gt; 95% family-wise confidence level</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear Hypotheses:</span></span>
<span><span class="co">#&gt;                        Estimate lwr    upr   </span></span>
<span><span class="co">#&gt; Bt - Control == 0      -4.333   -5.638 -3.029</span></span>
<span><span class="co">#&gt; Dimilin - Control == 0 -5.750   -7.055 -4.445</span></span>
<span><span class="co">#&gt; Dimilin - Bt == 0      -1.417   -2.721 -0.112</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="assignment">Assignment<a class="anchor" aria-label="anchor" href="#assignment"></a>
</h2>
<p>To determine if salinity affects fish reproductive performance, a
researcher places one pregnant female in a tank with one of three
salinity levels: low, medium, and high, or a control tank. A week after
birth, two offspring (fry) are measured.</p>
<p>The data can be accessed using:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"salinitydata"</span><span class="op">)</span></span></code></pre></div>
<p>Perform the appropriate analysis using <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code> and
<code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code> on the dataset. Answer the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>What are the null and alternative hypotheses?</p></li>
<li><p>Does salinity affect fry growth?</p></li>
<li><p>If so, which salinity levels differ?</p></li>
<li><p>Is there more random variation among or within experimental
units?</p></li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Do you think that it was important to include ‘adult’ as a random
effect or could this analysis have been simplified to a one-way
ANOVA?</li>
<li>Calculate a F-statistic and critical value to determine whether or
not to reject the null hypothesis related to the variance term.</li>
</ol>
<ol start="5" style="list-style-type: decimal">
<li>Include a well formatted ANOVA table (with header) from the aov()
results.</li>
</ol>
<p>You may format the report however you like but it should be
well-organized, with relevant headers, plain text, and the elements
described above.</p>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to:
<code>output: html_document</code></p></li>
<li><p>Be sure to include your first and last name in the
<code>author</code> section</p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code>
chunks so we can see both your code and the output</p></li>
<li><p>Please upload both the <code>html</code> and <code>.Rmd</code>
files when you submit your assignment</p></li>
<li><p>See the R Markdown reference sheet for help with creating
<code>R</code> chunks, equations, tables, etc.</p></li>
<li><p>See the “Creating publication-quality graphics” reference sheet
for tips on formatting figures</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
