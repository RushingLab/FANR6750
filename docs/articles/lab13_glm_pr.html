<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lab 13: Generalized linear models: Poisson Regression • FANR6750</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lab 13: Generalized linear models: Poisson Regression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FANR6750</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2025.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../articles/syllabus.html"><span class="fa fas fa-book"></span> Syllabus</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/schedule.html"><span class="fa fas fa-calendar"></span> Schedule</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lectures" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-file-pdf-o"></span> Lectures</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lectures">
<li><a class="dropdown-item" href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/01_intro_to_stats/01_intro_to_stats.html">Lecture 1: Introduction to statistics</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/02_intro_to_lm/02_intro_to_lm.html">Lecture 2: Introduction to linear models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/03_inference/03_inference.html">Lecture 3: Principles of inference</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/04_principles_of_expdesign/04_expdesign.html">Lecture 4: Principles of experimental design</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/05_t-test/05_t-test.html">Lecture 5: Linear models part 1: categorical predictor w/ 2 levels</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/06_nht/06_nht.html">Lecture 6: Null hypothesis significance testings</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/07_power/07_power.html">Lecture 7: Statistical power</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/08_anova/08_anova.html">Lecture 8: Linear models part 2: categorical predictor &gt; 2 levels</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/09_mult_comp/09_mult_comp.html">Lecture 9: Multiple Comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/10_regression/10_regression.html">Lecture 10: Multiple Regression</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-labs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-desktop"></span> Labs</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-labs">
<li><a class="dropdown-item" href="../articles/lab01_intro_to_R.html">Lab 1: Introduction to R</a></li>
    <li><a class="dropdown-item" href="../articles/lab02_Intro_project_and_Rmd.html">Lab 2: Introduction to projects and RMarkdown</a></li>
    <li><a class="dropdown-item" href="../articles/lab03_inference.html">Lab 3: Using R to explore sampling error</a></li>
    <li><a class="dropdown-item" href="../articles/lab04_t-tests.html">Lab 4: t-tests</a></li>
    <li><a class="dropdown-item" href="../articles/lab05_anova.html">Lab 5: ANOVA</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-references" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-pencil-square-o"></span> References</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-references">
<li><a class="dropdown-item" href="../articles/homework.html">Assignment instructions</a></li>
    <li><a class="dropdown-item" href="../articles/projects_and_directories.html">Projects and directories</a></li>
    <li><a class="dropdown-item" href="../articles/RMarkdown.html">R Markdown reference</a></li>
    <li><a class="dropdown-item" href="../articles/graphics.html">Creating publication-quality graphics</a></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Lab 13: Generalized linear models: Poisson Regression</h1>
            <h3 data-toc-skip class="subtitle">FANR 6750: Experimental
Methods in Forestry and Natural Resources Research</h3>
                        <h4 data-toc-skip class="author">Fall 2024</h4>
            
      

      <div class="d-none name"><code>lab13_glm_pr.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="lab-12">Lab 12<a class="anchor" aria-label="anchor" href="#lab-12"></a>
</h3>
<ul>
<li>
<p>Logistic Regression</p>
<ul>
<li><p>Link functions</p></li>
<li><p>Using glm()</p></li>
<li><p>Creating plots</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="todays-topics">Today’s topics<a class="anchor" aria-label="anchor" href="#todays-topics"></a>
</h3>
<ul>
<li>
<p>Poisson Regression</p>
<ul>
<li><p>Link functions</p></li>
<li><p>Creating plots</p></li>
<li><p>Poisson vs Negative binomial</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="poisson-regression">Poisson regression<a class="anchor" aria-label="anchor" href="#poisson-regression"></a>
</h2>
<p>This week we will see another situation where using a linear model
will not be the most appropriate approach. Here, we are interested in
using count data as our response variable and estimating counts as a
function of some predictors.</p>
<p><br></p>
<p>Let’s take a look at a data example to demonstrate this concept. The
data are modified from <a href="https://digitalcommons.unl.edu/cgi/viewcontent.cgi?article=1141&amp;context=usdeptcommercepub" class="external-link">Ver
Hoef and Boveng 2007</a> and include 400 observed counts of harbor seals
from aerial surveys conducted in coastal Alaska.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rushinglab.github.io/FANR6750">FANR6750</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"harbordata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">harbordata</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Survey Number substrate Reltolow      SITE</span></span>
<span><span class="co">#&gt; 1      1    250      rock      0.0 Abbess I.</span></span>
<span><span class="co">#&gt; 2      2    144      rock      3.2 Abbess I.</span></span>
<span><span class="co">#&gt; 3      3      0      rock      4.9 Alava Bay</span></span>
<span><span class="co">#&gt; 4      4     42      rock      3.6 Alava Bay</span></span>
<span><span class="co">#&gt; 5      5     10      rock      0.0 Alava Bay</span></span>
<span><span class="co">#&gt; 6      6      0      rock      1.6 Alava Bay</span></span></code></pre></div>
<p>First let’s visualize the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">harbordata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, y <span class="op">=</span> <span class="va">Number</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Tide relative to low (m)"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="lab13_glm_pr_files/figure-html/unnamed-chunk-3-1.png" alt="**Figure 1: Counts of harbor seals at sites across a range of tide heights (relative to low tide).**" width="576"><p class="caption">
<strong>Figure 1: Counts of harbor seals at sites across a range of tide
heights (relative to low tide).</strong>
</p>
</div>
<p><br></p>
<p>Here we are interested in estimating the count of harbor seals during
aerial surveys. Like last week, we could start by constructing a model
that estimates count as a function of tide height.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Number</span><span class="op">~</span> <span class="va">Reltolow</span>, data<span class="op">=</span> <span class="va">harbordata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Number ~ Reltolow, data = harbordata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt;  -92.4  -63.3  -29.0   38.7  663.6 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)    92.39       6.05   15.26  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; Reltolow      -11.52       2.17   -5.31  1.9e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 99.4 on 398 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.0661, Adjusted R-squared:  0.0637 </span></span>
<span><span class="co">#&gt; F-statistic: 28.2 on 1 and 398 DF,  p-value: 1.86e-07</span></span></code></pre></div>
<p>Now let’s add our model predictions to the plot from above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">harbordata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, y <span class="op">=</span> <span class="va">Number</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">harbordata</span><span class="op">$</span><span class="va">Reltolow</span>, <span class="va">model_pred</span><span class="op">)</span>, color<span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Tide relative to low (m)"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="lab13_glm_pr_files/figure-html/unnamed-chunk-5-1.png" alt="**Figure 2: Counts of harbor seals at sites across a range of tide heights (relative to low tide). Line represents model predictions from simple linear regression (mod1)**" width="576"><p class="caption">
<strong>Figure 2: Counts of harbor seals at sites across a range of tide
heights (relative to low tide). Line represents model predictions from
simple linear regression (mod1)</strong>
</p>
</div>
<p><br></p>
<p><strong>What issues do you see with this plot? Does this look like a
reasonable way to model this response variable?</strong></p>
<p>Similar to last week, we are again presented with a problem. We have
an integer count response variable but using a linear model results in
unreasonable predictions (since it is not possible for the response to
take on values in between the integers or below zero). We can resolve
this in a similar way as last week. In that lab, Our data was (0,1) and
we needed to create a response variable that could take on values only
between zero and one (inclusive) so probability was a reasonable choice.
In this case, our response is all possible positive integers but we need
a response that can take on all possible positive values. In this case,
we can model the mean response
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>)
rather than the count observations themselves. We could derive an
equation that estimates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
as a function of our predictor variables:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><msup><mi>e</mi><mrow><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mi>x</mi><mn>1</mn><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><msub><mi>β</mi><mi>z</mi></msub><msub><mi>x</mi><mi>z</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">
\lambda = e^{\beta_0 + \beta_1x1 + ... + \beta_zx_z}
</annotation></semantics></math></p>
<p><br><br> Now we’ve run into another problem. <strong>What is the
issue with this equation in the context of linear modeling?</strong></p>
<p><br><br></p>
<p>Instead, we can use a link function (in this case the log link) to
create a linear relationship between the response and the
predictors.</p>
<p>Remember from lecture that the model for the Poisson regression
is:</p>
<p><span class="math display">$$\Large log(\lambda_i) = \beta_0 +
\beta_1x_{i1} + \beta_2x_{i2} + · · · + \beta_px_{ip}$$</span> <span class="math display">$$\Large y_i \sim Poisson(\lambda_i)$$</span></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math>
is the expected value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math></p>
<p>Using the harbor data, let’s model the number of harbor seals
detected at each site as a function of site substrate and tide height
relative to low tide:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Number</span> <span class="op">~</span> <span class="va">substrate</span> <span class="op">+</span> <span class="va">Reltolow</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">harbordata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = Number ~ substrate + Reltolow, family = poisson(link = "log"), </span></span>
<span><span class="co">#&gt;     data = harbordata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)    5.42280    0.01343   403.7   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; substraterock -1.00615    0.01529   -65.8   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; substratesand -1.28421    0.03586   -35.8   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Reltolow      -0.19100    0.00386   -49.5   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 42725  on 399  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 34227  on 396  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 36116</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span></code></pre></div>
<p>Notice that we use the <code>family =</code> argument to tell
<code>R</code> that this is a poisson glm with a log link function.</p>
<p><strong>What do the parameter estimates from this model represent,
including the intercept? What can we say about the effects of substrate
and tide height on harbor seal counts?</strong></p>
<p><br><br></p>
<p>As we have seen previously, we can use <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> to
estimate counts at different combinations of tide height and substrate.
For example, how does the predicted count change across tide heights on
ice:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Reltolow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">harbordata</span><span class="op">$</span><span class="va">Reltolow</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">harbordata</span><span class="op">$</span><span class="va">Reltolow</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span>, substrate<span class="op">=</span> <span class="st">'ice'</span><span class="op">)</span></span></code></pre></div>
<p>To get confidence intervals on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>∞</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0, \infty)</annotation></semantics></math>
scale, predict on the log (link) scale and then back transform using the
inverse-link (<code><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp()</a></code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fm2</span>, newdata <span class="op">=</span> <span class="va">predData</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predData</span><span class="op">$</span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span> <span class="co"># exp is the inverse-link function</span></span>
<span><span class="va">predData</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">predData</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">harbordata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, y <span class="op">=</span> <span class="va">Number</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, y <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span>, color<span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype<span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Tide relative to low (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Expected count"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="lab13_glm_pr_files/figure-html/unnamed-chunk-8-1.png" alt="**Figure 3: Counts of harbor seals at sites on ice across a range of tide heights (relative to low tide). Line represents model predictions from poisson regression model and dashed lines represent approximate 95% confidence bands.**" width="576"><p class="caption">
<strong>Figure 3: Counts of harbor seals at sites on ice across a range
of tide heights (relative to low tide). Line represents model
predictions from poisson regression model and dashed lines represent
approximate 95% confidence bands.</strong>
</p>
</div>
<p><br><br></p>
<p>Although we have completed the analysis, this still may not be the
most appropriate way to consider this dataset. <strong>What are some
issues that you see either from the plot or from the model output
related to concepts discussed in lecture?</strong></p>
<p><strong>Why does the fitted line not appear to pass through the data
very well?</strong></p>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="negative-binomial-regression">Negative Binomial Regression<a class="anchor" aria-label="anchor" href="#negative-binomial-regression"></a>
</h2>
<p>In this dataset, assuming that the mean is equal to the variance may
not be a good idea. Especially considering that the mean count is 74.07
and the variance is 1.0558^{4}.</p>
<p>Instead, we could consider using a few other methods. In lecture, we
discussed the use of quasi-likelihood estimation (Quasi-Poisson). Here,
we will talk briefly about the Negative Binomial (NB) distribution.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;While quasi-poisson will produce identical coefficients
to using poisson regression, it will result in larger standard errors.
In contrast, quasi-poisson will actually produce different coefficients
than negative binomial regression. This is because the variance term in
quasi-poisson is considered to be a linear function of the mean while
the variance term in negative binomial regression is a quadratic (or
even cubic) function of the mean. As a result, quasi-poisson and
negative binomial regression are more or less appropriate than the other
depending on the data scenario.&lt;/p&gt;"><sup>1</sup></a></p>
<p>In some sense, the Poisson distribution can be thought of as a
specific case of the NB distribution where the mean is equal to the
variance. By relaxing this assumption though, we end up with two
parameters instead of one (the mean and the ‘dispersion’). This allows
for the scenarios where the variance is much larger than the mean
(overdispersion).</p>
<p><strong>What are some biological scenarios where we might see
this?</strong></p>
<p><br><br></p>
<p>Below, we will fit a NB model to the dataset and perform the plotting
steps as above to see how our results differ.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">nb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html" class="external-link">glm.nb</a></span><span class="op">(</span><span class="va">Number</span> <span class="op">~</span> <span class="va">substrate</span> <span class="op">+</span> <span class="va">Reltolow</span>, data <span class="op">=</span> <span class="va">harbordata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nb1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm.nb(formula = Number ~ substrate + Reltolow, data = harbordata, </span></span>
<span><span class="co">#&gt;     init.theta = 0.4661173743, link = log)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)     5.4190     0.2933   18.48  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; substraterock  -1.0372     0.3077   -3.37  0.00075 ***</span></span>
<span><span class="co">#&gt; substratesand  -1.3827     0.4500   -3.07  0.00212 ** </span></span>
<span><span class="co">#&gt; Reltolow       -0.1608     0.0327   -4.92  8.8e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for Negative Binomial(0.4661) family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 532.29  on 399  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 484.04  on 396  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 4009</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Theta:  0.4661 </span></span>
<span><span class="co">#&gt;           Std. Err.:  0.0319 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  2 x log-likelihood:  -3999.4500</span></span>
<span></span>
<span><span class="va">predDatanb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Reltolow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">harbordata</span><span class="op">$</span><span class="va">Reltolow</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">harbordata</span><span class="op">$</span><span class="va">Reltolow</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span>, substrate<span class="op">=</span> <span class="st">'ice'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred.linknb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">nb1</span>, newdata <span class="op">=</span> <span class="va">predDatanb</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predDatanb</span><span class="op">$</span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.linknb</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span> <span class="co"># exp is the inverse-link function</span></span>
<span><span class="va">predDatanb</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.linknb</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.linknb</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">predDatanb</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.linknb</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.linknb</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">harbordata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, y <span class="op">=</span> <span class="va">Number</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, y <span class="op">=</span> <span class="va">lambda</span>, color<span class="op">=</span> <span class="st">'Poisson'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, color<span class="op">=</span> <span class="st">'Poisson'</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="cn">NA</span>, linetype<span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predDatanb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, y <span class="op">=</span> <span class="va">lambda</span>, color<span class="op">=</span> <span class="st">'Negative Binomial'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predDatanb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Reltolow</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, color<span class="op">=</span> <span class="st">'Negative Binomial'</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="cn">NA</span>, linetype<span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Tide relative to low (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Expected count"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="lab13_glm_pr_files/figure-html/unnamed-chunk-9-1.png" alt="**Figure 4: Counts of harbor seals at sites across a range of tide heights (relative to low tide). Solid lines represent model predictions from poisson regression model and negative binomial regression model. Dashed lines represent approximate 95% confidence bands.**" width="576"><p class="caption">
<strong>Figure 4: Counts of harbor seals at sites across a range of tide
heights (relative to low tide). Solid lines represent model predictions
from poisson regression model and negative binomial regression model.
Dashed lines represent approximate 95% confidence bands.</strong>
</p>
</div>
<p><br></p>
<p><strong>In what ways do the model predictions from the NB regression
differ from the Poisson regression? Compare the information provided by
the model output from each model.</strong></p>
<p><br><br><br></p>
</div>
<div class="section level2">
<h2 id="assignment">Assignment<a class="anchor" aria-label="anchor" href="#assignment"></a>
</h2>
<p>Researchers are interested in understanding factors which affect
alligator clutch size (number of eggs). 350 nests were surveyed across 3
habitat types. During the surveys, the clutch size was recorded as well
as the length of the female alligator.</p>
<p>The data can be loaded using:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rushinglab.github.io/FANR6750">FANR6750</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"alligatordata"</span><span class="op">)</span></span></code></pre></div>
<p>Create an R markdown report to do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Use both regression methods discussed in lab (Poisson and NB) to
estimate clutch size as a function of the available predictors (2
pt)</p></li>
<li><p>Include a well-formatted summary table of the parameter estimates
from both models (1 pt)</p></li>
<li><p>Choose one of the models and provide a clear interpretation of
the parameter estimates (1 pt).</p></li>
<li>
<p>Use the poisson regression model to plot the relationship between
number of eggs and female length, for all three habitat types, on the
same graph. The graph should include (1 pt):</p>
<ul>
<li><p>the observed data points (color coded by habitat)</p></li>
<li><p>a legend</p></li>
<li><p>approximate 95% confidence intervals</p></li>
</ul>
</li>
<li>
<p>Create a plot of the relationship between number of eggs and
female length (at one of the three habitat types) using both regression
methods on the same graph. The graph should include (1 pt):</p>
<ul>
<li><p>the observed data points</p></li>
<li><p>a legend</p></li>
<li><p>approximate 95% confidence intervals</p></li>
</ul>
</li>
<li><p>Interpret the plot from Question 5. Which regression method do
you think is most appropriate for this dataset? Justify your decision (2
pt)</p></li>
</ol>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to:
<code>output: html_document</code></p></li>
<li><p>Be sure to include your first and last name in the
<code>author</code> section</p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code>
chunks so we can see both your code and the output</p></li>
<li><p>See the R Markdown reference sheet for help with creating
<code>R</code> chunks, equations, tables, etc.</p></li>
<li><p>See the “Creating publication-quality graphics” reference sheet
for tips on formatting figures</p></li>
</ul>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
